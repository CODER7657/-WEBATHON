<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StyleHub - Premium Fashion Store</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Poppins', sans-serif; }

    /* Custom Animations */
    @keyframes slideInFromTop { 0% { transform: translateY(-100px); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
    @keyframes slideInFromBottom { 0% { transform: translateY(100px); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
    @keyframes fadeInScale { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
    @keyframes bounce-in { 0% { transform: scale(0.3); opacity: 0; } 50% { transform: scale(1.05); } 70% { transform: scale(0.9); } 100% { transform: scale(1); opacity: 1; } }
    @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); } 50% { box-shadow: 0 0 40px rgba(99, 102, 241, 0.6); } }
    @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
    @keyframes shimmer { 0% { background-position: -1000px 0; } 100% { background-position: 1000px 0; } }

    .animate-slide-in-top { animation: slideInFromTop 0.8s ease-out; }
    .animate-slide-in-bottom { animation: slideInFromBottom 0.8s ease-out; }
    .animate-fade-in-scale { animation: fadeInScale 0.6s ease-out; }
    .animate-bounce-in { animation: bounce-in 0.8s ease-out; }
    .animate-pulse-glow { animation: pulse-glow 2s infinite; }
    .animate-float { animation: float 3s ease-in-out infinite; }

    /* Glass Effect */
    .glass-card { background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 25px 45px rgba(0, 0, 0, 0.1); }
    .glass-card-dark { background: rgba(0, 0, 0, 0.1); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); }

    /* Gradients */
    .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .gradient-bg-2 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
    .gradient-bg-3 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    .gradient-text { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }

    /* Product Card */
    .product-card { transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); transform-style: preserve-3d; }
    .product-card:hover { transform: translateY(-15px) rotateX(5deg); box-shadow: 0 25px 60px rgba(0,0,0,0.2); }
    .product-card:hover .product-image { transform: scale(1.1); }
    .product-image { transition: transform 0.4s ease; }

    /* Buttons */
    .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); transition: all 0.3s ease; position: relative; overflow: hidden; }
    .btn-primary::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: left 0.5s; }
    .btn-primary:hover::before { left: 100%; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(102,126,234,0.4); }

    /* Loading / Scrollbar */
    .shimmer-effect { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 1000px 100%; animation: shimmer 2s infinite; }
    ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-track { background: #f1f1f1; } ::-webkit-scrollbar-thumb { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 4px; }

    /* Backdrop */
    .modal-backdrop { background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px); }
    .notification { background: rgba(16, 185, 129, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }

    .hero-pattern { background-image: radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(255, 107, 107, 0.3) 0%, transparent 50%), radial-gradient(circle at 40% 40%, rgba(120, 219, 226, 0.3) 0%, transparent 50%); }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <div id="app-container"></div>

  <script>
    // === GLOBAL STATE ===
    let isLoggedIn = false;
    let currentPage = 'home'; // 'home' | 'checkout' | 'orders'
    let activeCategory = null; // 'Men' | 'Women' | 'Children'
    let selectedSubCategory = null;
    let cartItems = []; // {id, qty}
    let registeredUsers = {}; // {email: password}
    let currentUser = null; // email
    let searchQuery = '';

    // === DATA ===
    const products = [
      // Men's Products
      { id: 1, name: 'Premium Cotton Shirt', price: 59.99, category: 'Men', subCategory: 'Shirts', image: 'https://images.unsplash.com/photo-1596755094514-f87e34085b2c?w=800&h=800&fit=crop', rating: 4.8 },
      { id: 2, name: 'Slim Fit Dress Shirt', price: 69.99, category: 'Men', subCategory: 'Shirts', image: 'https://images.unsplash.com/photo-1602810318383-e386cc2a3ccf?w=800&h=800&fit=crop', rating: 4.7 },
      { id: 3, name: 'Classic Black Trousers', price: 79.99, category: 'Men', subCategory: 'Trousers', image: 'https://images.unsplash.com/photo-1624378515195-6bbdb73dff1a?w=800&h=800&fit=crop', rating: 4.9 },
      { id: 4, name: 'Dark Blue Jeans', price: 89.99, category: 'Men', subCategory: 'Jeans', image: 'https://images.unsplash.com/photo-1542272604-787c3835535d?w=800&h=800&fit=crop', rating: 4.6 },
      { id: 5, name: 'Light Blue Jeans', price: 85.99, category: 'Men', subCategory: 'Jeans', image: 'https://images.unsplash.com/photo-1581338834647-b0fb40704e21?w=800&h=800&fit=crop', rating: 4.5 },
      { id: 6, name: 'Graphic T-Shirt', price: 29.99, category: 'Men', subCategory: 'T-Shirts', image: 'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=800&h=800&fit=crop', rating: 4.3 },
      { id: 7, name: 'Plain White Tee', price: 24.99, category: 'Men', subCategory: 'T-Shirts', image: 'https://images.unsplash.com/photo-1581803118522-7b72a50f7e9f?w=800&h=800&fit=crop', rating: 4.4 },
      { id: 8, name: 'Designer Kurta', price: 99.99, category: 'Men', subCategory: 'Ethnic Wear', image: 'https://images.unsplash.com/photo-1583394838336-acd977736f90?w=800&h=800&fit=crop', rating: 4.8 },
      { id: 9, name: 'Leather Jacket', price: 199.99, category: 'Men', subCategory: 'Jackets', image: 'https://images.unsplash.com/photo-1551698618-1dfe5d97d256?w=800&h=800&fit=crop', rating: 4.9 },
      { id: 10, name: 'Luxury Watch', price: 299.99, category: 'Men', subCategory: 'Accessories', image: 'https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=800&h=800&fit=crop', rating: 5.0 },

      // Women's Products
      { id: 11, name: 'Elegant Maxi Dress', price: 129.99, category: 'Women', subCategory: 'Dresses', image: 'https://images.unsplash.com/photo-1566479179817-c0ed5b0e9906?w=800&h=800&fit=crop', rating: 4.7 },
      { id: 12, name: 'Floral Summer Dress', price: 89.99, category: 'Women', subCategory: 'Dresses', image: 'https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=800&h=800&fit=crop', rating: 4.6 },
      { id: 13, name: 'Silk Blouse', price: 79.99, category: 'Women', subCategory: 'Tops', image: 'https://images.unsplash.com/photo-1594633312681-425c7b97ccd1?w=800&h=800&fit=crop', rating: 4.8 },
      { id: 14, name: 'Casual Denim Top', price: 55.99, category: 'Women', subCategory: 'Tops', image: 'https://images.unsplash.com/photo-1564584217132-2271feaeb3c5?w=800&h=800&fit=crop', rating: 4.4 },
      { id: 15, name: 'Pleated Midi Skirt', price: 69.99, category: 'Women', subCategory: 'Skirts', image: 'https://images.unsplash.com/photo-1583496661160-fb5886a13d24?w=800&h=800&fit=crop', rating: 4.5 },
      { id: 16, name: 'Designer Saree', price: 199.99, category: 'Women', subCategory: 'Ethnic Wear', image: 'https://images.unsplash.com/photo-1610030469983-98e550d6193c?w=800&h=800&fit=crop', rating: 4.9 },
      { id: 17, name: 'Handbag Collection', price: 149.99, category: 'Women', subCategory: 'Accessories', image: 'https://images.unsplash.com/photo-1584917865442-de89df76afd3?w=800&h=800&fit=crop', rating: 4.6 },

      // Children's Products
      { id: 18, name: 'Kids Cartoon T-Shirt', price: 19.99, category: 'Children', subCategory: 'T-Shirts', image: 'https://images.unsplash.com/photo-1503919545889-aef636e10ad4?w=800&h=800&fit=crop', rating: 4.7 },
      { id: 19, name: "Girl's Pink Dress", price: 39.99, category: 'Children', subCategory: 'Dresses', image: 'https://images.unsplash.com/photo-1518831959646-742c3a14ebf7?w=800&h=800&fit=crop', rating: 4.8 },
      { id: 20, name: 'Kids Denim Jeans', price: 34.99, category: 'Children', subCategory: 'Jeans', image: 'https://images.unsplash.com/photo-1596755094514-f87e34085b2c?w=800&h=800&fit=crop', rating: 4.5 },
      { id: 21, name: 'Colorful Playwear', price: 29.99, category: 'Children', subCategory: 'Playwear', image: 'https://images.unsplash.com/photo-1519238263530-99bdd11df2ea?w=800&h=800&fit=crop', rating: 4.6 },
    ];

    const categories = {
      'Men': ['Shirts', 'Trousers', 'Ethnic Wear', 'Jeans', 'T-Shirts', 'Jackets', 'Accessories'],
      'Women': ['Dresses', 'Tops', 'Skirts', 'Ethnic Wear', 'Accessories'],
      'Children': ['T-Shirts', 'Jeans', 'Dresses', 'Playwear']
    };

    // === UTIL ===
    const formatCurrency = (n) => `₹${(n * 83).toFixed(0)}`; // rough INR display
    const getProduct = (id) => products.find(p => p.id === id);
    const cartCount = () => cartItems.reduce((a,c)=>a+c.qty,0);
    const cartSubtotal = () => cartItems.reduce((a,c)=> a + getProduct(c.id).price * c.qty, 0);

    function createStarRating(rating) {
      const full = Math.floor(rating); const half = rating % 1 !== 0; let html = '';
      for (let i=0;i<full;i++) html += '<svg class="w-4 h-4 text-yellow-400 fill-current" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>';
      if (half) html += '<svg class="w-4 h-4 text-yellow-400 fill-current" viewBox="0 0 20 20"><defs><linearGradient id="half"><stop offset="50%" stop-color="currentColor"/><stop offset="50%" stop-color="transparent"/></linearGradient></defs><path fill="url(#half)" d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>';
      const empty = 5 - Math.ceil(rating);
      for (let i=0;i<empty;i++) html += '<svg class="w-4 h-4 text-gray-300 fill-current" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z"/></svg>';
      return html;
    }

    // === PERSISTENCE ===
    const STORAGE_KEY = 'stylehub_state_v1';
    function saveState() {
      const state = { isLoggedIn, currentPage, activeCategory, selectedSubCategory, cartItems, registeredUsers, currentUser };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }
    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const s = JSON.parse(raw);
        isLoggedIn = !!s.isLoggedIn; currentPage = s.currentPage || 'home';
        activeCategory = s.activeCategory; selectedSubCategory = s.selectedSubCategory;
        cartItems = Array.isArray(s.cartItems) ? s.cartItems : [];
        registeredUsers = s.registeredUsers || {}; currentUser = s.currentUser || null;
      } catch (e) { console.error('State load failed', e); }
    }

    // === UI HELPERS ===
    function showNotification(text, type='success') {
      const wrap = document.createElement('div');
      wrap.className = 'fixed top-6 left-1/2 -translate-x-1/2 z-50';
      wrap.innerHTML = `
        <div class="notification ${type==='error' ? '!bg-red-500/95' : ''} text-white px-5 py-3 rounded-2xl shadow-xl flex items-center gap-3 animate-slide-in-top">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
          <span class="font-medium">${text}</span>
        </div>`;
      document.body.appendChild(wrap);
      setTimeout(()=>{ wrap.remove(); }, 2200);
    }

    function productCard(product) {
      return `
      <div class="product-card bg-white rounded-3xl shadow-xl overflow-hidden group animate-fade-in-scale">
        <div class="relative overflow-hidden rounded-t-3xl">
          <img src="${product.image}" alt="${product.name}" class="product-image w-full h-72 object-cover group-hover:scale-110 transition-transform duration-500" loading="lazy" />
          <div class="absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          <div class="absolute top-4 right-4 bg-white/90 backdrop-blur-sm rounded-full px-3 py-1 text-sm font-semibold text-gray-800 opacity-0 group-hover:opacity-100 transition-opacity">${product.category}</div>
        </div>
        <div class="p-5 text-center">
          <h3 class="text-lg font-bold text-gray-800 mb-1 group-hover:text-purple-600 transition-colors">${product.name}</h3>
          <div class="flex items-center justify-center mb-3">${createStarRating(product.rating)}<span class="text-gray-600 text-sm ml-2">(${Math.floor(Math.random()*100)+50})</span></div>
          <div class="flex items-center justify-center gap-2 mb-5">
            <span class="text-2xl font-bold gradient-text">$${product.price.toFixed(2)}</span>
            <span class="text-sm text-gray-400 line-through">$${(product.price*1.3).toFixed(2)}</span>
            <span class="text-xs text-green-600 font-semibold">Save 30%</span>
          </div>
          <button class="add-to-cart-btn btn-primary w-full py-3 px-6 text-white font-semibold rounded-2xl focus:outline-none focus:ring-4 focus:ring-purple-300 transition-all" data-product-id="${product.id}">
            <span class="flex items-center justify-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.293 2.293a1 1 0 00-.293.707V19a2 2 0 002 2h2a2 2 0 002-2v-.172a1 1 0 00-.293-.707L8 16"/></svg>
              <span>Add to Cart</span>
            </span>
          </button>
        </div>
      </div>`;
    }

    // === AUTH ===
    function createAuthForm(isLoginMode, message) {
      return `
      <div class="glass-card w-full max-w-md rounded-3xl p-8 animate-bounce-in">
        <div class="text-center mb-8">
          <div class="inline-block p-4 rounded-full gradient-bg mb-4 animate-pulse-glow">
            <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
          </div>
          <h1 class="text-4xl font-bold text-white mb-2 animate-float">StyleHub</h1>
          <p class="text-white/80 text-lg">${isLoginMode ? 'Welcome back to premium fashion!' : 'Join our exclusive fashion community'}</p>
        </div>
        ${message ? `<div id="auth-message" class="glass-card-dark p-4 rounded-2xl text-center mb-6 animate-slide-in-top"><p class="text-white font-medium">${message}</p></div>` : `<div id="auth-message" class="hidden"></div>`}
        <form onsubmit="handleAuth(event, ${isLoginMode})" class="space-y-6">
          <div class="space-y-4">
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                <svg class="w-5 h-5 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"/></svg>
              </div>
              <input type="email" name="email" placeholder="Email address" class="glass-card-dark w-full pl-12 pr-4 py-4 text-white placeholder-white/60 border-0 rounded-2xl focus:ring-2 focus:ring-white/50 transition-all" required />
            </div>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                <svg class="w-5 h-5 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
              </div>
              <input type="password" name="password" placeholder="Password" class="glass-card-dark w-full pl-12 pr-4 py-4 text-white placeholder-white/60 border-0 rounded-2xl focus:ring-2 focus:ring-white/50 transition-all" required />
            </div>
            ${!isLoginMode ? `
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                <svg class="w-5 h-5 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              </div>
              <input type="password" name="confirmPassword" placeholder="Confirm Password" class="glass-card-dark w-full pl-12 pr-4 py-4 text-white placeholder-white/60 border-0 rounded-2xl focus:ring-2 focus:ring-white/50 transition-all" required />
            </div>` : ''}
          </div>
          <button type="submit" class="btn-primary w-full py-4 text-white font-bold text-lg rounded-2xl focus:outline-none focus:ring-4 focus:ring-white/30 transition-all">
            <span class="flex items-center justify-center gap-2">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${isLoginMode ? 'M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1' : 'M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z'}"/></svg>
              <span>${isLoginMode ? 'Sign In to StyleHub' : 'Create Your Account'}</span>
            </span>
          </button>
        </form>
        <div class="mt-8 text-center">
          <p class="text-white/80">${isLoginMode ? "Don't have an account?" : "Already have an account?"}</p>
          <button onclick="renderAuthPage(${!isLoginMode})" class="mt-2 text-white font-bold text-lg hover:text-yellow-300 transition-colors underline-offset-4 hover:underline">${isLoginMode ? 'Create New Account' : 'Sign In Instead'}</button>
        </div>
      </div>`;
    }

    function handleAuth(event, isLoginMode) {
      event.preventDefault();
      const email = event.target.email.value.trim();
      const password = event.target.password.value.trim();
      let message = '';

      if (isLoginMode) {
        if (registeredUsers[email] && registeredUsers[email] === password) {
          isLoggedIn = true; currentUser = email; showNotification('✅ Welcome back! Login successful 🎉'); saveState(); renderApp();
        } else { message = '❌ Invalid credentials. Please try again.'; }
      } else {
        const confirmPassword = event.target.confirmPassword.value.trim();
        if (password !== confirmPassword) message = '⚠️ Passwords do not match!';
        else if (registeredUsers[email]) message = '⚠️ This email is already registered. Try logging in.';
        else if (password.length < 6) message = '⚠️ Password must be at least 6 characters long.';
        else {
          registeredUsers[email] = password; isLoggedIn = true; currentUser = email; showNotification('🎉 Account created successfully! Welcome to StyleHub.'); saveState(); renderApp();
        }
      }

      if (message) {
        const msg = document.getElementById('auth-message');
        if (msg) { msg.innerHTML = `<p class='text-white font-medium'>${message}</p>`; msg.classList.remove('hidden'); }
      }
    }

    function logout() {
      isLoggedIn = false; currentUser = null; currentPage='home'; saveState(); renderApp();
    }

    // === RENDERERS ===
    function renderHeader() {
      return `
      <header class="bg-white/90 backdrop-blur supports-[backdrop-filter]:bg-white/60 sticky top-0 z-40 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex items-center justify-between py-4 gap-4">
            <div class="flex items-center gap-8">
              <a href="#" class="flex items-center gap-2" onclick="currentPage='home'; renderApp();">
                <div class="w-10 h-10 rounded-xl gradient-bg flex items-center justify-center text-white font-extrabold">SH</div>
                <span class="text-2xl font-extrabold gradient-text">StyleHub</span>
              </a>
              <nav class="hidden md:flex items-center gap-3">
                ${['Men','Women','Children'].map(cat=>`<button class="px-4 py-2 rounded-xl hover:bg-gray-100 ${activeCategory===cat?'bg-gray-900 text-white':'text-gray-700'}" onclick="activeCategory='${cat}'; selectedSubCategory=null; currentPage='home'; renderApp();">${cat}</button>`).join('')}
              </nav>
            </div>
            <div class="flex-1 max-w-xl hidden md:block">
              <div class="flex items-center bg-gray-100 rounded-2xl px-4 py-2">
                <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M11 19a8 8 0 100-16 8 8 0 000 16z"/></svg>
                <input value="${searchQuery}" oninput="searchQuery=this.value; renderApp();" class="bg-transparent w-full pl-2 outline-none" placeholder="Search for products, categories..." />
              </div>
            </div>
            <div class="flex items-center gap-3">
              <button class="relative rounded-2xl px-3 py-2 hover:bg-gray-100" onclick="openCart()">
                <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.293 2.293a1 1 0 00-.293.707V19a2 2 0 002 2h2a2 2 0 002-2v-.172a1 1 0 00-.293-.707L8 16"/></svg>
                ${cartCount()?`<span class="absolute -top-1 -right-1 text-xs bg-purple-600 text-white rounded-full px-1.5">${cartCount()}</span>`:''}
              </button>
              <div class="relative group">
                <button class="rounded-2xl px-3 py-2 hover:bg-gray-100 flex items-center gap-2">
                  <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                  <span class="hidden sm:block text-sm font-semibold">${currentUser || 'Account'}</span>
                </button>
                <div class="hidden group-hover:block absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-xl p-2">
                  <button class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-100" onclick="currentPage='orders'; renderApp();">My Orders</button>
                  <button class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-100" onclick="logout()">Logout</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </header>`;
    }

    function renderHomePage() {
      const left = activeCategory ? `
      <aside class="hidden md:block md:w-64">
        <div class="bg-white rounded-2xl p-4 shadow-sm sticky top-24">
          <h4 class="font-semibold mb-2">${activeCategory} Categories</h4>
          <div class="flex flex-col gap-1">
            ${categories[activeCategory].map(sc=>`<button class="text-left px-3 py-2 rounded-xl ${selectedSubCategory===sc?'bg-gray-900 text-white':'hover:bg-gray-100'}" onclick="selectedSubCategory='${sc}'; renderApp();">${sc}</button>`).join('')}
            <button class="text-left px-3 py-2 rounded-xl hover:bg-gray-100" onclick="selectedSubCategory=null; renderApp();">All</button>
          </div>
        </div>
      </aside>` : '';

      // Filter logic
      let list = products.slice();
      if (activeCategory) list = list.filter(p=>p.category===activeCategory);
      if (selectedSubCategory) list = list.filter(p=>p.subCategory===selectedSubCategory);
      if (searchQuery) list = list.filter(p=> (p.name+" "+p.category+" "+p.subCategory).toLowerCase().includes(searchQuery.toLowerCase()));

      const hero = `
      <section class="hero-pattern gradient-bg text-white rounded-3xl p-8 md:p-12 shadow-md animate-slide-in-top">
        <div class="grid md:grid-cols-2 gap-6 items-center">
          <div>
            <p class="uppercase tracking-widest text-white/80">Premium Fashion</p>
            <h1 class="text-4xl md:text-5xl font-extrabold leading-tight mt-2">Elevate your style with <span class="underline decoration-yellow-300">StyleHub</span></h1>
            <p class="mt-3 text-white/90">Discover curated looks for Men, Women and Children. New arrivals weekly. Free shipping over $99.</p>
            <div class="mt-6 flex gap-3">
              <button class="btn-primary px-6 py-3 rounded-2xl text-white font-semibold" onclick="activeCategory='Men'; selectedSubCategory=null; renderApp();">Shop Men</button>
              <button class="bg-white/20 hover:bg-white/30 px-6 py-3 rounded-2xl font-semibold" onclick="activeCategory='Women'; selectedSubCategory=null; renderApp();">Shop Women</button>
            </div>
          </div>
          <div class="hidden md:block">
            <div class="bg-white/20 rounded-3xl h-56 md:h-64 flex items-center justify-center animate-float">
              <span class="text-2xl font-semibold">🎁 Festive Sale: Extra 10% OFF</span>
            </div>
          </div>
        </div>
      </section>`;

      const grid = `
      <section class="mt-8">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl font-bold">${activeCategory?activeCategory:'All'} ${selectedSubCategory?('› '+selectedSubCategory):''} ${searchQuery?('› "'+searchQuery+'"'):''}</h2>
          <div class="flex items-center gap-2">
            <label class="text-sm text-gray-600">Sort:</label>
            <select class="bg-white border rounded-xl px-3 py-2" onchange="sortProducts(this.value)">
              <option value="popular">Most Popular</option>
              <option value="price_asc">Price: Low to High</option>
              <option value="price_desc">Price: High to Low</option>
              <option value="rating">Top Rated</option>
            </select>
          </div>
        </div>
        ${list.length? `<div class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">${list.map(productCard).join('')}</div>` : `<div class="bg-white p-10 rounded-2xl text-center">No products found.</div>`}
      </section>`;

      return `
      <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="grid md:grid-cols-[auto,1fr] gap-6">
          ${left}
          <div>${hero}${grid}</div>
        </div>
      </main>`;
    }

    function sortProducts(type){
      const cmp = {
        price_asc: (a,b)=>a.price-b.price,
        price_desc: (a,b)=>b.price-a.price,
        rating: (a,b)=>b.rating-a.rating,
        popular: ()=>0,
      }[type] || (()=>0);
      products.sort(cmp); renderApp();
    }

    function renderCheckoutPage() {
      const items = cartItems.map(ci=>({ ...getProduct(ci.id), qty: ci.qty }));
      const subtotal = cartSubtotal();
      const shipping = subtotal>99 ? 0 : 9.99;
      const tax = subtotal*0.08;
      const total = subtotal + shipping + tax;

      return `
      <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <h2 class="text-2xl font-extrabold mb-6">Checkout</h2>
        <div class="grid lg:grid-cols-3 gap-6">
          <div class="lg:col-span-2 bg-white rounded-2xl p-6 shadow-sm">
            <h3 class="font-semibold mb-4">Shipping Details</h3>
            <form id="checkout-form" class="grid md:grid-cols-2 gap-4">
              <input class="border rounded-xl px-4 py-3" placeholder="Full Name" required />
              <input class="border rounded-xl px-4 py-3" placeholder="Phone" required />
              <input class="md:col-span-2 border rounded-xl px-4 py-3" placeholder="Address" required />
              <div class="grid grid-cols-3 gap-3 md:col-span-2">
                <input class="border rounded-xl px-4 py-3" placeholder="City" required />
                <input class="border rounded-xl px-4 py-3" placeholder="State" required />
                <input class="border rounded-xl px-4 py-3" placeholder="PIN Code" required />
              </div>
              <button class="btn-primary mt-2 px-6 py-3 rounded-2xl text-white font-semibold md:col-span-2" onclick="placeOrder(event)">Place Order</button>
            </form>
          </div>
          <div class="bg-white rounded-2xl p-6 shadow-sm">
            <h3 class="font-semibold mb-4">Order Summary</h3>
            <div class="flex flex-col gap-3 max-h-72 overflow-auto">
              ${items.map(it=>`<div class='flex items-center justify-between'><span>${it.name} × ${it.qty}</span><span>${formatCurrency(it.price*it.qty)}</span></div>`).join('')}
            </div>
            <div class="mt-4 border-t pt-4 text-sm">
              <div class="flex justify-between"><span>Subtotal</span><span>${formatCurrency(subtotal)}</span></div>
              <div class="flex justify-between"><span>Shipping</span><span>${shipping?formatCurrency(shipping):'FREE'}</span></div>
              <div class="flex justify-between"><span>Tax (8%)</span><span>${formatCurrency(tax)}</span></div>
              <div class="flex justify-between font-bold text-lg mt-2"><span>Total</span><span>${formatCurrency(total)}</span></div>
            </div>
          </div>
        </div>
      </main>`;
    }

    function placeOrder(e){
      e.preventDefault();
      if(!cartItems.length){ showNotification('Cart is empty', 'error'); return; }
      const orderId = 'ORD' + Math.floor(Math.random()*1e6).toString().padStart(6,'0');
      const existing = JSON.parse(localStorage.getItem('stylehub_orders')||'[]');
      existing.push({ id: orderId, user: currentUser, items: cartItems, date: new Date().toISOString() });
      localStorage.setItem('stylehub_orders', JSON.stringify(existing));
      cartItems = []; saveState();
      showNotification('🎉 Order placed successfully! #' + orderId);
      currentPage='orders'; renderApp();
    }

    function renderOrdersPage(){
      const all = JSON.parse(localStorage.getItem('stylehub_orders')||'[]');
      const my = all.filter(o=>o.user===currentUser).reverse();
      return `
      <main class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <h2 class="text-2xl font-extrabold mb-6">My Orders</h2>
        ${my.length? `<div class='space-y-4'>${my.map(o=>{
          const total = o.items.reduce((a,c)=>a+getProduct(c.id).price*c.qty,0);
          return `<div class='bg-white rounded-2xl p-5 shadow-sm flex items-center justify-between'>
            <div>
              <div class='font-bold'>#${o.id}</div>
              <div class='text-sm text-gray-500'>${new Date(o.date).toLocaleString()}</div>
              <div class='text-sm mt-1'>${o.items.length} item(s)</div>
            </div>
            <div class='font-bold'>${formatCurrency(total)}</div>
          </div>`;}).join('')}</div>` : `<div class='bg-white rounded-2xl p-10 text-center'>No orders yet.</div>`}
      </main>`;
    }

    // === CART ===
    function openCart(){ document.getElementById('cart-drawer')?.classList.remove('hidden'); document.getElementById('cart-backdrop')?.classList.remove('hidden'); }
    function closeCart(){ document.getElementById('cart-drawer')?.classList.add('hidden'); document.getElementById('cart-backdrop')?.classList.add('hidden'); }

    function addToCart(id){
      const idx = cartItems.findIndex(ci=>ci.id===id);
      if (idx>-1) cartItems[idx].qty += 1; else cartItems.push({id, qty:1});
      saveState(); showNotification('🛒 Added to cart'); renderApp();
    }
    function changeQty(id, delta){
      const idx = cartItems.findIndex(ci=>ci.id===id); if (idx===-1) return;
      cartItems[idx].qty += delta; if (cartItems[idx].qty<=0) cartItems.splice(idx,1);
      saveState(); renderApp();
    }
    function removeFromCart(id){ cartItems = cartItems.filter(ci=>ci.id!==id); saveState(); renderApp(); }

    function renderCartDrawer(){
      const items = cartItems.map(ci=>({ ...getProduct(ci.id), qty: ci.qty }));
      const subtotal = cartSubtotal();
      return `
      <div id="cart-backdrop" class="hidden fixed inset-0 modal-backdrop z-40" onclick="closeCart()"></div>
      <aside id="cart-drawer" class="hidden fixed right-0 top-0 h-full w-full sm:w-[420px] bg-white z-50 shadow-2xl flex flex-col">
        <div class="p-4 border-b flex items-center justify-between">
          <h3 class="font-bold text-lg">Your Cart (${cartCount()} items)</h3>
          <button class="rounded-xl px-3 py-1 hover:bg-gray-100" onclick="closeCart()">Close</button>
        </div>
        <div class="flex-1 overflow-auto p-4 space-y-3">
          ${items.length? items.map(it=>`
            <div class='flex gap-3 items-center'>
              <img src='${it.image}' class='w-16 h-16 rounded-xl object-cover' alt='${it.name}'/>
              <div class='flex-1'>
                <div class='font-semibold'>${it.name}</div>
                <div class='text-sm text-gray-500'>${it.subCategory}</div>
                <div class='font-bold mt-1'>${formatCurrency(it.price)}</div>
              </div>
              <div class='flex items-center gap-2'>
                <button class='px-2 py-1 rounded-lg bg-gray-100' onclick='changeQty(${it.id},-1)'>-</button>
                <span class='min-w-6 text-center'>${it.qty}</span>
                <button class='px-2 py-1 rounded-lg bg-gray-100' onclick='changeQty(${it.id},1)'>+</button>
              </div>
              <button class='ml-2 text-red-500' onclick='removeFromCart(${it.id})'>Remove</button>
            </div>`).join('') : `<div class='text-center text-gray-500 mt-10'>Your cart is empty.</div>`}
        </div>
        <div class="p-4 border-t">
          <div class="flex items-center justify-between mb-3"><span class="text-sm text-gray-600">Subtotal</span><span class="font-bold">${formatCurrency(subtotal)}</span></div>
          <button class="btn-primary w-full py-3 rounded-2xl text-white font-semibold ${items.length? '' : 'opacity-50 cursor-not-allowed'}" ${items.length? `onclick="currentPage='checkout'; closeCart(); renderApp();"` : 'disabled'}>Checkout</button>
        </div>
      </aside>`;
    }

    // === ROOT RENDER ===
    function renderAuthPage(isLogin = true){
      currentPage = 'auth';
      document.getElementById('app-container').innerHTML = `
        <div class='min-h-screen gradient-bg hero-pattern flex items-center justify-center p-6'>
          ${createAuthForm(isLogin)}
        </div>`;
    }

    function attachProductHandlers(){
      document.querySelectorAll('.add-to-cart-btn').forEach(btn=>{
        btn.addEventListener('click', ()=> addToCart(parseInt(btn.dataset.productId)));
      });
    }

    function renderApp(){
      if (!isLoggedIn) { renderAuthPage(true); return; }
      const header = renderHeader();
      const main = currentPage==='home' ? renderHomePage() : currentPage==='checkout' ? renderCheckoutPage() : renderOrdersPage();
      const cart = renderCartDrawer();
      const html = header + main + cart + renderFooter();
      document.getElementById('app-container').innerHTML = html;
      attachProductHandlers();
    }

    function renderFooter(){
      return `
      <footer class="mt-12 border-t">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 grid md:grid-cols-4 gap-6 text-sm">
          <div>
            <div class="flex items-center gap-2 mb-2"><div class="w-8 h-8 rounded-lg gradient-bg text-white flex items-center justify-center font-extrabold">SH</div><span class="font-extrabold">StyleHub</span></div>
            <p class="text-gray-500">Premium fashion for everyone. Quality, comfort, and style in every stitch.</p>
          </div>
          <div>
            <h4 class="font-semibold mb-2">Shop</h4>
            <ul class="space-y-1">
              <li><button onclick="activeCategory='Men'; selectedSubCategory=null; renderApp();" class="hover:underline">Men</button></li>
              <li><button onclick="activeCategory='Women'; selectedSubCategory=null; renderApp();" class="hover:underline">Women</button></li>
              <li><button onclick="activeCategory='Children'; selectedSubCategory=null; renderApp();" class="hover:underline">Children</button></li>
            </ul>
          </div>
          <div>
            <h4 class="font-semibold mb-2">Support</h4>
            <ul class="space-y-1">
              <li><a href="#" class="hover:underline">Contact</a></li>
              <li><a href="#" class="hover:underline">Shipping & Returns</a></li>
              <li><a href="#" class="hover:underline">FAQs</a></li>
            </ul>
          </div>
          <div>
            <h4 class="font-semibold mb-2">Newsletter</h4>
            <div class="flex gap-2">
              <input class="border rounded-xl px-4 py-2 w-full" placeholder="Your email" />
              <button class="btn-primary px-4 py-2 rounded-xl text-white">Join</button>
            </div>
          </div>
        </div>
        <div class="text-center text-xs text-gray-500 pb-6">© <span id="year"></span> StyleHub. All rights reserved.</div>
      </footer>`;
    }

    // === INIT ===
    loadState();
    renderApp();
    document.addEventListener('DOMContentLoaded', ()=>{
      const y = document.getElementById('year'); if (y) y.textContent = new Date().getFullYear();
    });
  </script>
</body>
</html>
